---
id: webhook
sidebar_position: 6
---

# 自定义触点管理


## 功能概述

为满足业务系统个性化、复杂程度较高的触点配置，智能运营提供自定义触点（即webhook）的方式进行营销渠道的扩展。

- webhook是一个http形式的回调接口，该接口需要您的研发团队进行开发工作，详细技术对接文档见[自定义触点接入文档](/developer-manual/Tech-plan/webhook-tech.md)
- 当用户满足策略条件时，智能运营系统会去调用webhook触达接口，并把触达信息（给谁发什么内容）以json格式的请求体传递给您的服务，您就可以在服务中利用这些信息进行后续的触达操作，比如给用户发放优惠券等。

## 适用场景
企业已经拥有了一套消息推送平台或权益系统，那么您就可以编写一个webhook进行中转，在智能运营系统与已有的系统之间做适配。例如：对接企业发券系统、对接企业消息中心、提供满足策略规则的用户数据等。

## 添加触点
在自定义触点列表中，点击【添加触点】即跳转出添加触点的弹窗，分为基础信息配置和发送参数配置。
### 基本信息
![图 5](/img/694680a2c9f126119425c5ae5116a23a1da0364a133128256fdcad5d451cf293.png)  
#### 输入触点名称
输入触点名称，字数限制在15个以内；

#### 选择触点类型
触点类型分为通知（如短信、公众号）、权益（如券、积分）以及其他，可根据实际触点情况进行选择；

应用场景：单个策略器中可设置多个同一个类型的触点均触达或按照优先级仅触达一个触点。

#### 输入请求地址
该地址为触点触达接口，如优惠券发放接口。

#### 输入认证token
非必填，当系统发起webhook请求时，会根据token生成签名并作为请求参数传递到触达接口中，主要用于校验请求的有效性。

#### 输入批次设定
支持自定义每次调用接口时传输的消息量。支持输入正整数，限制为1～500；

系统默认批量发送，如果下游接口不支持批量，可以设置为1。

#### 选择是否获取回执
即触达接口的请求回执，主要用于营销活动的结果数据统计，方便对活动执行效果进行分析，另外最终触达数据也会上报到数据中心，用于后续的分析和处理。
![图 6](/img/63314e54da70f3230a5295049ee6dbb00a2e4074884d04add0930e4b3ac8f5f4.png)  

**获取回执：**

即异步查询触达结果，适用于下游接口不能及时返回最终结果的场景，可配置回执地址以及异步查询超时时间。当智能运营系统对下游触达接口调用成功后，会通过定时任务5分钟查询一次触达结果（触达成功/失败），超过超时时间未查询到结果则视为触达失败。
> 注意:异步获取回执也需要输入API地址，API需符合growing IO接口规范

**不获取回执：**

如果webhook接口可以立即返回触达的结果，那么可以选择不获取回执，直接在调用结果中返回触达结果的详细数据，返回参数数据结构参照:[自定义触点接入文档](/developer-manual/Tech-plan/webhook-tech.md#触点触达接口)

### 发送参数
#### 添加用户属性
用户属性配置成功之后，运营人员在创建活动时不需要重复定义该部分内容。智能运营系统会把满足策略条件用户的属性数据自动映射到请求参数并添加到请求体中。支持添加多条用户属性，至少要添加一条。
![图 7](/img/7a09edfc2825db2b03444e91cfbb20c98950b26108c8eeef5d340f7db0badfcb.png)  

- 参数属性：选择要发送的用户属性，可范围包括该项目下已上报到数据中心的所有用户身份和属性；
- 参数标识：智能运营发起webhook请求时传递的参数名称，选择属性后会自动带入该属性在数据中心的标识，同时也可以自定义；
- 参数名称：webhook服务中参数的显示名称，用于反映不同系统间参数名称的关联关系；
- 默认值：当属性值为空时使用默认值，非必填。

#### 添加模版参数
模板参数配置成功之后，运营人员在创建活动时就可以灵活定义这些模板参数的值，比如在模板参数中配置了标签、内容，那么后续每次创建活动时可自定义输入要发送的标题和内容是什么。支持添加多条模板参数，至少要添加一条。
![图 8](/img/76e1364f8814a018eaa0c547df72d1280531f3bf93afe8bdcdb537a46e0866fa.png)  

- 参数标识：智能运营发起webhook请求时，传递的参数名称，需与您实际接口中的参数标识一致；
- 参数名称：参数的显示名称，在活动中配置策略时页面上显示的名称，比如标题；
- 参数类型：当前支持的类型为日期型、数值型、枚举型以及文本型；其中枚举型支持人工配置枚举值以及通过API获取枚举值；另外，不同类型的参数，在活动中配置策略时输入内容的组件不同；
- 默认值：当属性值为空时使用默认值；
- 是否必填：运营人员在活动中配置策略时，必填参数全部填写才能提交。

**参数类型-日期**

适用于时间、有效期等场景，模版参数配置为日期型时，活动中配置策略时前端展示为时间选择器。

**参数类型-数值**

适用于金额、人数、个数等数值输入的场景，模版参数配置为数值型时，活动中配置策略时前端展示为数值输入框。

**参数类型-枚举**

当模板参数值是比较固定的几个或者是由另外一个系统生成的，这个时候往往不需要运营人员自己输入参数值，而是在众多值中选择一个或多个即可，这种场景下比较适合配置成枚举型。

智能运营系统支持人工配置枚举值以及API获取枚举值2种方式，并且支持配置允许单选或多选。

![图 9](/img/216945300ecabf92fb5b9b00f8a1c773829a9d56601aa7199e7605eb50f8d34c.png)  

- 人工配置枚举值：适用于枚举值较少（如10个以内）以及变动不会很频繁的场景，可在此处配置枚举值的code以及名称，至少要配置1个枚举值；
- API获取枚举值：适用于内容在其他系统进行创建生成，会随着业务进行随时调整的场景，比如对接企业素材中心；您可在此处输入API地址，该接口应由企业内容管理平台提供，智能运营系统调用，获取到枚举值后在配置策略时进行展示。

> 注1:获取枚举值的API需符合growing IO接口规范
>
> 注2:为了保证下拉组件的流程性等使用体验，请将枚举值的数量控制在50个以内；
>
> 注3:在您的内容管理平台中创建素材之后，在智能运营平台选择时可能会延后几分钟才能获取到最新添加的内容，若有活动需要，建议您提早创建素材。

**参数类型-文本**

适用于纯内容输入的场景，模版参数配置为数值型时，活动中配置策略时前端展示为文本输入框，并且支持在文本中插入用户属性。

### 保存及应用
所有信息配置完成，提交保存后即可在触点管理页面中查看。再次进行空间授权后，运营人员即可在创建活动时选择该触点配置策略内容。

以下为一个发券场景的配置示例，可供参考：
![图 10](/img/c17fa0525d5fe2ae3ad7a70d3bea095739813b57f2661b64c6e81d5b257dfee3.png)  

![图 11](/img/03fbac613516e21cd9f8a77c3a117116fee3ccbf53d6b6a7fa48566060f60293.png)  

在活动中选择该触点的界面，如下图：
![图 12](/img/ea82dbe5cd0267a8d5a94f657a80644cc92a9ce6f59fa39c96fb0c4d4bd2798a.png)  

## 触点管理

### 空间授权
触点配置完成后默认是开启的状态，但此时该触点是未授权给任何一个空间的，运营人员在配置策略时也无法使用该触点。所以需要在触点列表中点击【授权空间】按钮，可进行触点授权配置，配置完成后，对应授权空间下的运营人员就可以使用该触点进行触达策略配置。
![图 13](/img/75a586d333d16c5c505c58c0f26ff93b88770871e62d912c51ba534aee190482.png)  

### 触点编辑
- 触点禁用后才可以进行信息的编辑，启用状态下编辑按钮置灰；
- 触点编辑时触点类型（通知、权益或其他）无法进行修改。

### 测试发送
触点创建完成之后，可以先进行测试发送，确定能够将消息发送成功之后，可配置授权空间即可使用。在触点列表中，点击【测试】按钮，可填写测试发送信息。

点击【发送测试】之后，智能运营系统会调用触达接口进行发送，请您确认是否收到发送内容，若未收到可排查的方向：
- 触达接口是否按照Growing IO接口规范开发；
- 接口是否可用；
- 由于触达消息是智能运营调用接口传给您的业务系统，业务系统可能还会再调用其他厂商进行发送，可能存在接口延时或者不排除一些厂商原因；
- 当以上因素排除后依然无法收到触达内容，请联系Growing IO技术支持排查。

### 启用/禁用
- 当该触点被进行中、暂停中、未开始、待发布、审批中状态的活动所引用时，无法直接禁用，需要关闭对应的活动后才能执行禁用操作；
- 触点禁用后无法在流程画布配置策略时选择该触点。

### 删除
- 启用中的触点无法直接进行删除，需要先进行禁用操作。

## 接口对接
Webhook 自定义触点的接口对接文档详见[自定义触点接入文档](/developer-manual/Tech-plan/webhook-tech.md)
